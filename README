Based in Gist #998096 (https://gist.github.com/998096)
